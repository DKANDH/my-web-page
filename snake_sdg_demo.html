<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SDGs æ•™è‚²ç‰ˆè²ªåƒè›‡ï¼ˆç¯„ä¾‹ï¼šSDG6 & SDG13ï¼‰</title>
  <style>
    :root {
      --bg: #0b1020;
      --panel: #121833;
      --accent: #7dd3fc;
      --accent-2: #a78bfa;
      --text: #e5e7eb;
      --muted: #94a3b8;
      --good: #34d399;
      --warn: #fbbf24;
      --bad: #ef4444;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      background: radial-gradient(1200px 600px at 10% 10%, #0f1533 0%, var(--bg) 45%, #070a17 100%);
      color: var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans TC", "PingFang TC", "Heiti TC", "Microsoft JhengHei", Arial, sans-serif;
      display: grid;
      min-height: 100svh;
      place-items: center;
      padding: 24px;
    }
    .app { width: 100%; max-width: 720px; display: grid; gap: 16px; }
    .card {
      background: linear-gradient(180deg, rgba(255,255,255,0.05), rgba(255,255,255,0.02));
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 16px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.35);
      padding: 16px;
    }
    h1 {
      margin: 0;
      font-weight: 700;
      letter-spacing: 0.3px;
      background: linear-gradient(90deg, var(--accent), var(--accent-2));
      -webkit-background-clip: text; background-clip: text; color: transparent;
      font-size: clamp(22px, 3.6vw, 28px);
    }
    .row { display: flex; gap: 12px; align-items: center; flex-wrap: wrap; justify-content: space-between; }
    .stats { display: flex; gap: 12px; flex-wrap: wrap; align-items: center; }
    .badge {
      display: inline-flex; align-items: center; gap: 8px; padding: 8px 12px; border-radius: 999px;
      background: rgba(255,255,255,0.06); border: 1px solid rgba(255,255,255,0.08);
      font-weight: 600; font-variant-numeric: tabular-nums;
    }
    .controls { display: flex; gap: 8px; flex-wrap: wrap; align-items: center; }
    button {
      appearance: none; border: 1px solid rgba(255,255,255,0.12);
      background: rgba(255,255,255,0.06); color: var(--text);
      padding: 10px 14px; border-radius: 12px; font-weight: 700; letter-spacing: 0.3px;
      cursor: pointer; transition: transform .06s ease, background .2s ease, border-color .2s ease;
    }
    button:hover { background: rgba(255,255,255,0.12); }
    button:active { transform: translateY(1px) scale(0.99); }
    .primary { border-color: rgba(125,211,252,0.5); background: linear-gradient(180deg, rgba(125,211,252,0.25), rgba(167,139,250,0.18)); }
    .danger { border-color: rgba(239,68,68,0.4); background: linear-gradient(180deg, rgba(239,68,68,0.2), rgba(239,68,68,0.08)); }
    .canvas-wrap { display: grid; gap: 12px; justify-items: center; }
    canvas {
      width: min(96vw, 600px); aspect-ratio: 1 / 1; image-rendering: pixelated;
      border-radius: 12px; background: linear-gradient(180deg, #0b142b, #0a1022);
      border: 1px solid rgba(255,255,255,0.08);
      box-shadow: inset 0 0 0 1px rgba(255,255,255,0.03), 0 15px 40px rgba(0,0,0,0.45);
      touch-action: none;
    }
    .dpad { display: grid; grid-template-areas: ". up ." "left . right" ". down ."; gap: 8px; user-select: none; }
    .dpad button { width: 64px; height: 64px; border-radius: 12px; font-size: 16px; }
    .dpad .up { grid-area: up; } .dpad .down { grid-area: down; } .dpad .left { grid-area: left; } .dpad .right { grid-area: right; }
    .hint { color: var(--muted); font-size: 13px; text-align: center; }
    .footer { text-align: center; color: var(--muted); font-size: 12px; }
    /* Toast */
    .toast {
      position: fixed; left: 50%; top: 18px; transform: translateX(-50%);
      background: rgba(17,24,39,0.95); color: #e5e7eb; border: 1px solid rgba(255,255,255,0.1);
      padding: 10px 14px; border-radius: 12px; box-shadow: 0 8px 24px rgba(0,0,0,0.35);
      display: none; z-index: 50; max-width: min(92vw, 560px);
    }
    .toast.show { display: block; animation: fade 0.25s ease-out; }
    @keyframes fade { from { opacity: 0; transform: translate(-50%,-6px);} to{opacity:1; transform: translate(-50%,0);} }
    .legend { display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
    .legend .tag { display:inline-flex; align-items:center; gap:6px; padding:6px 10px; border-radius: 999px; background: rgba(255,255,255,0.06); border: 1px solid rgba(255,255,255,0.08); font-size: 13px; }
    .dot { width: 12px; height: 12px; border-radius: 999px; display:inline-block; }
  </style>
</head>
<body>
  <div class="app">
    <div class="card">
      <div class="row">
        <h1>SDGs æ•™è‚²ç‰ˆè²ªåƒè›‡ï¼ˆç¯„ä¾‹ï¼šSDG6 & SDG13ï¼‰</h1>
        <div class="controls">
          <button id="startBtn" class="primary">é–‹å§‹/æš«åœ (Space)</button>
          <button id="resetBtn" class="danger">é‡æ–°é–‹å§‹ (R)</button>
        </div>
      </div>
      <div class="row">
        <div class="stats">
          <span class="badge">åˆ†æ•¸ï¼š<span id="score">0</span></span>
          <span class="badge">æœ€â¾¼ï¼š<span id="best">0</span></span>
          <span class="badge">é€Ÿåº¦ï¼š<span id="speed">1x</span></span>
          <span class="badge">æ£‹ç›¤ï¼š<span id="sizeLabel">20Ã—20</span></span>
          <span class="badge">SDG6ï¼š<span id="c6">0</span></span>
          <span class="badge">SDG13ï¼š<span id="c13">0</span></span>
        </div>
        <div class="controls">
          <label>å°ºå¯¸
            <select id="sizeSel">
              <option value="16">16Ã—16</option>
              <option value="20" selected>20Ã—20</option>
              <option value="24">24Ã—24</option>
              <option value="28">28Ã—28</option>
              <option value="32">32Ã—32</option>
            </select>
          </label>
          <label>é€Ÿåº¦
            <select id="speedSel">
              <option value="1" selected>1x</option>
              <option value="1.3">1.3x</option>
              <option value="1.6">1.6x</option>
              <option value="2.0">2x</option>
            </select>
          </label>
        </div>
      </div>
      <div class="legend" aria-hidden="true">
        <span class="tag"><span class="dot" style="background:#00ADEF"></span> SDG 6 æ½”æ·¨æ°´èˆ‡è¡›ç”Ÿ</span>
        <span class="tag"><span class="dot" style="background:#3F7E44"></span> SDG 13 æ°£å€™è¡Œå‹•</span>
      </div>
    </div>

    <div class="card canvas-wrap">
      <canvas id="game" width="600" height="600" aria-label="Snake Game" role="img"></canvas>
      <div class="dpad" aria-hidden="false">
        <button class="up">â¬†</button>
        <button class="left">â¬…</button>
        <button class="right">â¡</button>
        <button class="down">â¬‡</button>
      </div>
      <div class="hint">æ–¹å‘éµ / WASD æ“æ§ï¼›æ‰‹æ©Ÿå¯ç”¨æ–¹å‘éµæˆ–æ»‘å‹•ã€‚åƒåˆ°ä¸åŒç›®æ¨™æœƒé¡¯ç¤ºæ•™è‚²è¨Šæ¯ã€‚</div>
    </div>

    <div class="footer">
      Made for SDGs practice â€” å–®æª”é›¢ç·šç¶²é ï¼Œå¯ç›´æ¥ä¸Š GitHub Pagesã€‚
    </div>
  </div>

  <div id="toast" class="toast" role="status" aria-live="polite"></div>

  <script>
    (() => {
      const canvas = document.getElementById('game');
      const ctx = canvas.getContext('2d');
      const startBtn = document.getElementById('startBtn');
      const resetBtn = document.getElementById('resetBtn');
      const scoreEl = document.getElementById('score');
      const bestEl = document.getElementById('best');
      const speedEl = document.getElementById('speed');
      const sizeSel = document.getElementById('sizeSel');
      const speedSel = document.getElementById('speedSel');
      const sizeLabel = document.getElementById('sizeLabel');
      const c6El = document.getElementById('c6');
      const c13El = document.getElementById('c13');
      const toast = document.getElementById('toast');

      const store = window.localStorage;
      const BEST_KEY = 'snake_best_sdg_demo_v1';
      let best = parseInt(store.getItem(BEST_KEY) || '0', 10) || 0;
      bestEl.textContent = best;

      // Game state
      let N = 20; // grid size
      let cell = 24; // pixel per cell (auto-fit by canvas size)
      let snake = [];
      let dir = { x: 1, y: 0 };
      let nextDir = { x: 1, y: 0 };
      let food = { x: 10, y: 10, kind: 'sdg6' };
      let score = 0;
      let running = false;
      let gameOver = false;
      let baseMs = 140; // base tick
      let tickMs = baseMs;
      let lastTime = 0;
      let acc = 0;
      let count6 = 0, count13 = 0;

      function resizeToCanvas() {
        const size = Math.min(window.innerWidth * 0.96, 600);
        canvas.style.width = size + 'px';
        canvas.style.height = size + 'px';
        cell = Math.floor(canvas.width / N);
        sizeLabel.textContent = N + 'Ã—' + N;
      }

      function randInt(max) { return Math.floor(Math.random() * max); }

      function randomKind() {
        return Math.random() < 0.5 ? 'sdg6' : 'sdg13';
      }

      function placeFood() {
        while (true) {
          const x = randInt(N), y = randInt(N);
          if (!snake.some(s => s.x === x && s.y === y)) {
            food = { x, y, kind: randomKind() };
            break;
          }
        }
      }

      function resetGame() {
        score = 0; scoreEl.textContent = score;
        gameOver = false; running = false;
        dir = { x: 1, y: 0 }; nextDir = { x: 1, y: 0 };
        const cx = Math.floor(N / 2); const cy = Math.floor(N / 2);
        snake = [{ x: cx - 1, y: cy }, { x: cx, y: cy }];
        placeFood();
        baseMs = 140; tickMs = baseMs;
        speedEl.textContent = (baseMs / 140).toFixed(1) + 'x';
        count6 = 0; count13 = 0; c6El.textContent = '0'; c13El.textContent = '0';
        draw();
        showToast('ğŸ® é–‹å§‹æŒ‘æˆ° SDG 6 èˆ‡ SDG 13ï¼åƒåˆ°åœ–æ¨™æœƒé¡¯ç¤ºçŸ¥è­˜é»ã€‚');
      }

      function drawGrid() {
        ctx.fillStyle = '#0a1022'; ctx.fillRect(0, 0, canvas.width, canvas.height);
        ctx.strokeStyle = 'rgba(255,255,255,0.05)'; ctx.lineWidth = 1;
        for (let i = 0; i <= N; i++) {
          const p = i * cell + 0.5;
          ctx.beginPath(); ctx.moveTo(p, 0); ctx.lineTo(p, N * cell); ctx.stroke();
          ctx.beginPath(); ctx.moveTo(0, p); ctx.lineTo(N * cell, p); ctx.stroke();
        }
      }

      function drawSnake() {
        for (let i = 0; i < snake.length; i++) {
          const s = snake[i];
          const t = i / (snake.length - 1 || 1);
          // red â†’ yellow gradient for the body
          const hueA = 0, hueB = 60; // red â†’ yellow
          const hue = hueA + (hueB - hueA) * t;
          ctx.fillStyle = `hsl(${hue}deg 80% 60%)`;
          ctx.fillRect(s.x * cell + 1, s.y * cell + 1, cell - 2, cell - 2);
        }
      }

      function drawFood() {
        const gx = food.x * cell, gy = food.y * cell;
        const cx = gx + cell / 2, cy = gy + cell / 2;
        // Glow
        const r = cell * 0.48;
        const grd = ctx.createRadialGradient(cx, cy, r * 0.1, cx, cy, r);
        if (food.kind === 'sdg6') {
          grd.addColorStop(0, 'rgba(0,173,239,0.95)'); // SDG6 blue
          grd.addColorStop(1, 'rgba(0,173,239,0.15)');
        } else {
          grd.addColorStop(0, 'rgba(63,126,68,0.95)'); // SDG13 green
          grd.addColorStop(1, 'rgba(63,126,68,0.15)');
        }
        ctx.fillStyle = grd;
        ctx.beginPath(); ctx.arc(cx, cy, r, 0, Math.PI * 2); ctx.fill();

        // Icon drawing
        if (food.kind === 'sdg6') {
          // Water droplet shape
          ctx.fillStyle = '#00ADEF';
          ctx.beginPath();
          const topX = cx, topY = gy + cell * 0.15;
          ctx.moveTo(topX, topY);
          ctx.bezierCurveTo(cx - cell*0.28, gy + cell*0.40, cx - cell*0.22, gy + cell*0.78, cx, gy + cell*0.85);
          ctx.bezierCurveTo(cx + cell*0.22, gy + cell*0.78, cx + cell*0.28, gy + cell*0.40, topX, topY);
          ctx.fill();
          // highlight
          ctx.fillStyle = 'rgba(255,255,255,0.6)';
          ctx.beginPath();
          ctx.ellipse(cx - cell*0.10, gy + cell*0.40, cell*0.07, cell*0.12, -0.4, 0, Math.PI*2);
          ctx.fill();
        } else {
          // Leaf shape
          ctx.fillStyle = '#3F7E44';
          ctx.beginPath();
          ctx.moveTo(cx, gy + cell*0.18);
          ctx.bezierCurveTo(cx - cell*0.38, cy, cx - cell*0.28, gy + cell*0.82, cx, gy + cell*0.82);
          ctx.bezierCurveTo(cx + cell*0.28, gy + cell*0.82, cx + cell*0.38, cy, cx, gy + cell*0.18);
          ctx.fill();
          // vein
          ctx.strokeStyle = 'rgba(255,255,255,0.7)'; ctx.lineWidth = 1.5;
          ctx.beginPath(); ctx.moveTo(cx, gy + cell*0.22); ctx.lineTo(cx, gy + cell*0.78); ctx.stroke();
        }
      }

      function draw() {
        drawGrid();
        drawFood();
        drawSnake();
        if (gameOver) {
          ctx.fillStyle = 'rgba(0,0,0,0.55)';
          ctx.fillRect(0, 0, canvas.width, canvas.height);
          ctx.fillStyle = '#e5e7eb';
          ctx.textAlign = 'center';
          ctx.font = 'bold ' + Math.max(22, Math.floor(cell * 0.9)) + 'px system-ui, -apple-system, Segoe UI, Roboto';
          ctx.fillText('éŠæˆ²çµæŸ', canvas.width / 2, canvas.height / 2 - cell * 1.1);
          ctx.font = '16px system-ui';
          ctx.fillText(`ç¸½åˆ†ï¼š${score}ï½œSDG6ï¼š${count6}ï½œSDG13ï¼š${count13}`, canvas.width / 2, canvas.height / 2 - cell * 0.2);
          ctx.font = '14px system-ui';
          ctx.fillText('æŒ‰ä¸‹ R é‡æ–°é–‹å§‹', canvas.width / 2, canvas.height / 2 + cell * 0.8);
        }
      }

      function step(dt) {
        if (!running || gameOver) return;
        acc += dt;
        while (acc >= tickMs) {
          acc -= tickMs;
          if (nextDir.x !== -dir.x || nextDir.y !== -dir.y) dir = nextDir;
          const head = { x: snake[snake.length - 1].x + dir.x, y: snake[snake.length - 1].y + dir.y };
          if (head.x < 0 || head.y < 0 || head.x >= N || head.y >= N) { gameOver = true; running = false; draw(); return; }
          if (snake.some(s => s.x === head.x && s.y === head.y)) { gameOver = true; running = false; draw(); return; }
          snake.push(head);
          if (head.x === food.x && head.y === food.y) {
            score += 1; scoreEl.textContent = score;
            if (score > best) { best = score; bestEl.textContent = best; store.setItem(BEST_KEY, String(best)); }
            // Counters + educational toast
            if (food.kind === 'sdg6') { count6++; c6El.textContent = count6; showToast('ğŸ’§ ä½ æ”¶é›†äº† SDG 6ï¼šæ½”æ·¨æ°´èˆ‡è¡›ç”Ÿã€‚é‡é»ï¼šç¢ºä¿æ‰€æœ‰äººéƒ½èƒ½å–å¾—å®‰å…¨é£²ç”¨æ°´èˆ‡è¡›ç”Ÿè¨­æ–½ã€‚'); }
            else { count13++; c13El.textContent = count13; showToast('ğŸŒ¿ ä½ æ”¶é›†äº† SDG 13ï¼šæ°£å€™è¡Œå‹•ã€‚é‡é»ï¼šæ¡å–ç·Šæ€¥è¡Œå‹•æ‡‰å°æ°£å€™è®Šé·åŠå…¶å½±éŸ¿ã€‚'); }
            // speed up a bit (floor)
            baseMs = Math.max(70, baseMs - 2);
            tickMs = baseMs / parseFloat(speedSel.value);
            speedEl.textContent = (140 / baseMs * parseFloat(speedSel.value)).toFixed(1) + 'x';
            placeFood();
          } else {
            snake.shift();
          }
          draw();
        }
      }

      function loop(ts) {
        const dt = ts - lastTime; lastTime = ts;
        step(dt);
        requestAnimationFrame(loop);
      }

      function setDir(dx, dy) { nextDir = { x: dx, y: dy }; }

      // Inputs
      window.addEventListener('keydown', (e) => {
        const k = e.key.toLowerCase();
        if (k === ' ' || k === 'spacebar') { toggle(); e.preventDefault(); }
        if (k === 'r') { resetGame(); e.preventDefault(); }
        if (k === 'arrowup' || k === 'w') { setDir(0,-1); e.preventDefault(); }
        if (k === 'arrowdown' || k === 's') { setDir(0, 1); e.preventDefault(); }
        if (k === 'arrowleft' || k === 'a') { setDir(-1,0); e.preventDefault(); }
        if (k === 'arrowright' || k === 'd') { setDir(1, 0); e.preventDefault(); }
      }, { passive: false });

      // D-Pad
      document.querySelector('.dpad .up').addEventListener('click', () => setDir(0,-1));
      document.querySelector('.dpad .down').addEventListener('click', () => setDir(0,1));
      document.querySelector('.dpad .left').addEventListener('click', () => setDir(-1,0));
      document.querySelector('.dpad .right').addEventListener('click', () => setDir(1,0));

      // Swipe
      let touchStart = null;
      canvas.addEventListener('touchstart', (e) => { const t = e.touches[0]; touchStart = { x: t.clientX, y: t.clientY }; }, { passive: true });
      canvas.addEventListener('touchmove', (e) => {
        if (!touchStart) return; const t = e.touches[0];
        const dx = t.clientX - touchStart.x; const dy = t.clientY - touchStart.y;
        if (Math.hypot(dx, dy) > 24) { if (Math.abs(dx) > Math.abs(dy)) setDir(Math.sign(dx), 0); else setDir(0, Math.sign(dy)); touchStart = null; }
      }, { passive: true });
      canvas.addEventListener('touchend', () => touchStart = null, { passive: true });

      function toggle() { if (gameOver) return; running = !running; startBtn.textContent = running ? 'æš«åœ (Space)' : 'é–‹å§‹ (Space)'; }
      startBtn.addEventListener('click', toggle);
      resetBtn.addEventListener('click', () => resetGame());
      sizeSel.addEventListener('change', () => { N = parseInt(sizeSel.value, 10); resetGame(); });
      speedSel.addEventListener('change', () => { tickMs = baseMs / parseFloat(speedSel.value); speedEl.textContent = (140 / baseMs * parseFloat(speedSel.value)).toFixed(1) + 'x'; });
      window.addEventListener('resize', resizeToCanvas);

      function showToast(msg, ms = 3500) {
        toast.textContent = msg; toast.classList.add('show');
        clearTimeout(showToast._t); showToast._t = setTimeout(() => toast.classList.remove('show'), ms);
      }

      // init
      resizeToCanvas();
      resetGame();
      requestAnimationFrame(loop);
    })();
  </script>
</body>
</html>
